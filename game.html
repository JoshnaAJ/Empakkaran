<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Burp Challenge ‚Äî Strength & Length</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    .game-container { max-width: 800px; margin: 0 auto; }
    .meter { background: var(--card-bg); border-radius: 12px; height: 18px; overflow: hidden; box-shadow: 0 4px 8px var(--shadow); }
    .meter-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #4CAF50, #FF9800, #F44336); transition: width .08s linear; }
    .readouts { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; margin: 16px 0; }
    .readout { background: var(--card-bg); border-radius: 12px; padding: 12px; box-shadow: 0 4px 8px var(--shadow); }
    .readout h4 { margin: 0 0 6px 0; color: var(--accent); }
    .score-controls { display:flex; gap:10px; justify-content:center; flex-wrap: wrap; margin: 12px 0; }
    .scoreboard { margin-top: 16px; }
    .scoreboard li { display:flex; justify-content: space-between; align-items:center; }
    .rank { font-weight: bold; color: var(--accent); margin-right: 8px; }
    .back-link { display:inline-block; margin-top:16px; text-decoration:none; }
    .top-controls { display:flex; gap:10px; justify-content:center; flex-wrap: wrap; margin: 8px 0 16px; }
    .top-controls select, .top-controls button { padding: 8px 12px; border: 2px solid var(--border); border-radius: 8px; background: var(--card-bg); color: var(--text); font-family: inherit; }
    .top-controls button.primary { background: #ffcc00; border: 3px dashed var(--border); border-radius: 12px; }
    .viz { background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 8px var(--shadow); margin: 14px 0; padding: 6px; }
    #vizCanvas { width: 100%; height: 140px; display:block; }
    .target-badge { display:inline-block; padding: 6px 10px; border-radius: 999px; background: var(--accent); color: white; font-weight: bold; }
    .muted { opacity: .7; font-size: .9rem; }
    .countdown-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.5); display: none; align-items:center; justify-content:center; z-index: 999; }
    .countdown-overlay .num { font-size: 6rem; color: #fff; text-shadow: 0 6px 18px rgba(0,0,0,.4); }
    /* Start/Stop emphasis */
    .control-row { display:flex; gap: 12px; align-items: center; justify-content: center; flex-wrap: wrap; margin: 8px 0 14px; }
    .cta-start, .cta-stop { font-size: 22px; padding: 14px 24px; border-radius: 12px; border: none; cursor: pointer; }
    .cta-start { background: #2ecc71; color: white; box-shadow: 0 6px 12px rgba(46,204,113,.25); }
    .cta-stop { background: #e74c3c; color: white; box-shadow: 0 6px 12px rgba(231,76,60,.25); }
    .cta-start:disabled, .cta-stop:disabled { opacity: .6; cursor: not-allowed; }
    .status-badge { display:inline-block; padding: 6px 12px; border-radius: 999px; font-weight: 700; }
    .status-ready { background: #ececec; color: #555; }
    .status-listening { background: #3498db; color: #fff; }
    .status-recording { background: #ff66cc; color: #fff; }
    .status-ended { background: #9b59b6; color: #fff; }
    .status-calibrating { background: #f39c12; color: #fff; }
    .level-select label { font-weight: bold; }
  </style>
</head>
<body>
  <div class="container game-container">
    <h1>Burp Challenge üçª</h1>
    <p>Measure how strong and how long your burp is. One burp per round.</p>

    <div class="top-controls">
      <select id="modeSelect" aria-label="Game mode">
        <option value="endurance">Endurance (Longest)</option>
        <option value="power">Power (Strongest)</option>
        <option value="target">Target (Aim Strength)</option>
      </select>
      <div class="level-select">
        <label for="levelSelect">Level:</label>
        <select id="levelSelect" aria-label="Difficulty level">
          <option value="1">1 (Easy)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Hard)</option>
        </select>
      </div>
      <button id="calibrateBtn">Calibrate Noise</button>
      <span class="muted">Threshold: <span id="thresholdValue">0.18</span></span>
    </div>

    <div class="control-row">
      <button id="startBtn" class="cta-start">‚ñ∂ Start</button>
      <button id="stopBtn" class="cta-stop" disabled>‚èπ Stop</button>
      <span id="statusBadge" class="status-badge status-ready">Ready</span>
    </div>

    <div class="meter" aria-label="Burp strength meter">
      <div id="meterFill" class="meter-fill"></div>
    </div>

    <div class="viz">
      <canvas id="vizCanvas" width="760" height="140" aria-label="Waveform visualizer"></canvas>
    </div>

    <div class="readouts">
      <div class="readout">
        <h4>Current Strength</h4>
        <div><span id="currentRMS">0.00</span></div>
      </div>
      <div class="readout">
        <h4>Max Strength (Round)</h4>
        <div><span id="maxRMS">0.00</span></div>
      </div>
      <div class="readout">
        <h4>Current Duration</h4>
        <div><span id="currentDuration">0.00s</span></div>
      </div>
      <div class="readout">
        <h4>Score</h4>
        <div><span id="scoreValue">0</span> pts</div>
      </div>
      <div class="readout">
        <h4>Best Duration (All Time)</h4>
        <div><span id="bestDuration">0.00s</span></div>
      </div>
      <div class="readout" id="targetReadout" style="display:none;">
        <h4>Target Strength</h4>
        <div><span class="target-badge" id="targetValue">0.30 RMS</span></div>
      </div>
    </div>

    <div class="score-controls">
      <input id="playerName" type="text" placeholder="Your name" maxlength="24" />
      <button id="saveScoreBtn" disabled>Save This Burp</button>
      <button id="resetScoresBtn">Reset Scores</button>
    </div>

    <div class="scoreboard">
      <h3>Top Burps üèÜ</h3>
      <ul id="scoreList"></ul>
    </div>

    <a class="back-link" href="index.html"><button>‚Üê Back to Tracker</button></a>
  </div>

  <div id="background"></div>

  <div id="countdownOverlay" class="countdown-overlay"><div id="countdownNum" class="num">3</div></div>

  <script src="game.js"></script>
</body>
</html> 